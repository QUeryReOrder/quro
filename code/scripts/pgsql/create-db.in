#!/bin/bash
#
# This file is released under the terms of the Artistic License.
# Please see the file LICENSE, included in this package, for details.
#
# Copyright (C) 2002-2006 Mark Wong & Open Source Development Labs, Inc.
#

usage()
{
	echo "usage: create-db -h"
	echo "usage: create-db [-p port]"
}

TOPDIR="@abs_top_srcdir@"
source ${TOPDIR}/scripts/dbt5_profile || exit 1

DIR=`dirname $0`
. ${DIR}/pgsql_profile || exit 1

while getopts "hp:" OPT; do
	case ${OPT} in
	h)
		usage
		exit 0
		;;
	p)
		PORT=${OPTARG}
		;;
	esac
done

# Create database
echo "Creating database..."
if [ -d ${PGDATA} ]; then
	echo "======================================="
	echo "PGData directory ${PGDATA} already exists"
	echo "Skipping initdb"
	echo "======================================="
else
	${INITDB} -D ${PGDATA} --locale=C || exit 1
	cp -p ${DIR}/pg_hba.conf ${PGDATA}/ || exit 1
fi

${DIR}/start-db -p "-c port=${PORT}"

# Give the database a few seconds to get going
sleep 4

${CREATEDB} -p ${PORT} -E SQL_ASCII ${DBNAME} || exit 1
${CREATELANG} -p ${PORT} plpgsql ${DBNAME} || exit 1

exit 0
